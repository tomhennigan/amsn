srcdir		:= @srcdir@
VPATH		:= $(srcdir)


# programs
CC		:= @CC@
CXX		:= @CXX@

# misc
VERSION		:= 2.0
PACKAGE		:= capture

# for CFLAGS
WARN_FLAGS	:= -Wall -Wmissing-prototypes -Wstrict-prototypes -Wpointer-arith
LFS_FLAGS	:= -D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64
LIB_FLAGS	:= -I. -I$(srcdir)/libng -I$(srcdir)/structs -Llibng
LIBDIR		:= @LIBDIR@


# various libraries
THREAD_LIBS	:= @LIBPTHREAD@
ALSA_LIBS	:= @LIBALSA@
MAD_LIBS	:= @LIBMAD@
MPEG2_LIBS	:= @LIBMPEG2@
GL_LIBS		:= @LIBGL@


# Directories in which the Tcl core can be found
TCL_INC_SPEC 	= @TCL_INC_SPEC@
TCL_STUB_LIB_SPEC = @TCL_STUB_LIB_SPEC@

# Directories in which the Tk core can be found
TK_INC_SPEC 	= @TK_INC_SPEC@
TK_STUB_LIB_SPEC = @TK_STUB_LIB_SPEC@



# stuff configure has found
FOUND_ALSA	:= @FOUND_ALSA@
FOUND_GL	:= @FOUND_GL@
FOUND_MAD	:= @FOUND_MAD@
FOUND_MPEG2	:= @FOUND_MPEG2@
FOUND_OS	:= @FOUND_OS@
USE_MMX		:= @USE_MMX@

# build final cflags
CFLAGS   := @CFLAGS@
CFLAGS   += $(WARN_FLAGS)
CFLAGS   += $(LFS_FLAGS)
CFLAGS	 += ${TCL_INC_SPEC}
CFLAGS	 += ${TK_INC_SPEC}
CFLAGS   += $(LIB_FLAGS)
CFLAGS   += -DPACKAGE='"$(PACKAGE)"'
CFLAGS   += -DVERSION='"$(VERSION)"'
CFLAGS   += -DLIBDIR='"$(LIBDIR)"'
CXXFLAGS := $(CFLAGS)

# for gcc3
#CFLAGS   += -std-gnu99

# shared objects need -fPIC
%.so : CFLAGS   += -fPIC
%.so : CXXFLAGS += -fPIC

# libraries
LDLIBS  := @LDLIBS@
LDFLAGS := @LDFLAGS@

LDFLAGS	 += ${TCL_STUB_LIB_SPEC}
LDFLAGS	 += ${TK_STUB_LIB_SPEC}

#########################################################
# targets

build: all

Makefile: $(srcdir)/Makefile.in $(srcdir)/configure
	$(srcdir)/configure

$(srcdir)/configure: $(srcdir)/configure.ac
	(cd $(srcdir); ./autogen.sh)

clean::
	find . -name \*~ -print | xargs rm -f
	find . -name \*.o -print | xargs rm -f
	find . -name \*.a -print | xargs rm -f
	find . -name \*.dep -print | xargs rm -f


distclean:: clean
	-rm -f Makefile Make.config
	-rm -f config.cache config.h config.log config.status


#########################################################
# some rules ...

include $(srcdir)/Compile.mk


#########################################################
# include stuff

# subdirs
include $(srcdir)/Rules.mk
include $(srcdir)/libng/Rules.mk
include $(srcdir)/libng/plugins/Rules.mk
include $(srcdir)/libng/contrib-plugins/Rules.mk

